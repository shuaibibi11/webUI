# 和元智擎政易大模型对话平台重构计划

## 一、项目概述
基于现有代码重构，实现全栈数据落库、Bisheng工作流深度适配及全流程闭环管理。

## 二、技术栈调整
- **后端**：Spring Boot 2.7.18 → Spring Boot 3.x
- **前端**：Vue 3 + TypeScript + Pinia + Naive UI
- **数据库**：PostgreSQL（使用 JSONB 存储复杂配置，RLS 策略）
- **核心引擎**：Bisheng Workflow API

## 三、重构步骤

### 1. 后端重构

#### 1.1 升级 Spring Boot 版本
- 修改父 pom.xml 中的 Spring Boot 版本为 3.x
- 调整相关依赖版本，确保兼容性
- 更新 JPA 相关配置，适配 Spring Boot 3.x

#### 1.2 调整数据库设计
- 修改 User 实体：增加 status 字段（PENDING/ACTIVE/BANNED）
- 修改 Conversation 实体：增加 is_deleted 字段
- 修改 Message 实体：增加 feedback_status 字段（like/dislike/none）
- 确保所有唯一性约束正确配置
- 配置 PostgreSQL RLS 策略

#### 1.3 实现用户认证模块
- 完善注册流程：前端校验唯一性，后端审批机制
- 实现三合一登录：账号/邮箱/手机号登录
- 实现找回密码功能
- 集成身份证正则验证

#### 1.4 集成 Bisheng Workflow API
- 实现 Bisheng API 客户端
- 支持 SSE 流式响应
- 实现对话流管理
- 支持暂停生成功能

#### 1.5 完善后台管理系统
- 实现账号管理：实名审批、用户操作
- 实现模型配置：API_KEY、APP_ID、API_URL 配置
- 实现日志管理：全埋点、导出功能
- 实现反馈管理：查看、处理用户反馈
- 实现协议修改：富文本编辑器集成

### 2. 前端开发

#### 2.1 初始化前端项目
- 使用 Vite 创建 Vue 3 + TypeScript 项目
- 集成 Pinia 和 Naive UI
- 配置路由和状态管理

#### 2.2 实现身份认证模块
- 设计左右分栏或居中卡片式登录页面
- 实现注册表单，包含严格验证
- 实现登录流程，包含协议同意
- 实现找回密码功能

#### 2.3 实现核心对话终端
- 设计沉浸式对话布局
- 实现左侧侧边栏：新建对话、历史会话列表
- 实现右侧主对话区：对话流、操作栏
- 实现流式输出：光标闪烁、文字逐字显现
- 实现暂停生成功能

#### 2.4 实现全局反馈系统
- 右下角悬浮反馈按钮
- 反馈表单设计
- 提交反馈后实时提示

#### 2.5 实现后台管理系统
- 经典 Admin 布局，延续前台风格
- 实现账号管理页面
- 实现模型配置页面
- 实现日志管理页面
- 实现反馈管理页面
- 实现协议修改页面

### 3. 测试与部署

#### 3.1 单元测试
- 后端接口测试
- 前端组件测试

#### 3.2 集成测试
- 前后端联调
- Bisheng API 集成测试

#### 3.3 部署配置
- 配置 Docker 环境
- 编写 docker-compose.yml
- 配置 Nginx 反向代理

## 四、关键功能实现

### 1. 身份认证
- 注册时实时校验唯一性
- 注册后状态为 PENDING，需后台审批
- 三合一登录支持
- 协议同意强制校验

### 2. 对话终端
- SSE 流式响应
- 实时数据落库
- 暂停生成功能
- 对话操作栏（点赞、不认可、复制、转发）

### 3. 后台管理
- 实名审批流程
- 模型配置管理
- 全埋点日志
- 反馈处理机制

## 五、UI/UX 设计

### 1. 视觉体系
- 主色调：科技蓝/浅蓝（#1677FF 或 #409EFF）
- 辅助色：清新白、高级灰、柔和灰
- 字体：简洁无衬线字体

### 2. 交互动效
- 按钮点击缩放微动效
- 侧边栏平滑过渡
- 光标闪烁呼吸效果
- 文字逐字显现

### 3. 布局特征
- 圆角设计：8px 至 12px
- 悬浮感：轻微 box-shadow

## 六、端口配置
- 用户对话页面：11020
- 后台管理系统页面：11025
- 数据库等其他端口：11100-11200 之间

## 七、预期成果
- 完成全栈重构，实现所有功能模块
- 符合 UI/UX 设计规范
- 支持 Bisheng Workflow API 深度适配
- 实现全流程闭环管理
- 数据安全可靠，符合政务系统要求