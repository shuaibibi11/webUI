# 系统全面修复计划

## 1. 前端Vue警告修复

**问题**：登录页面出现Vue警告，Failed setting prop "prefix" on <div>
**原因**：Input组件的prefix属性被设置为函数，而该属性只有getter
**修复方案**：
- 检查admin-web和user-web的登录页面组件
- 修改Input组件的prefix属性使用方式，确保传入正确的类型
- 文件：`/data/webUI-java/admin-web/src/views/Login.vue` 和 `/data/webUI-java/user-web/src/views/Login.vue`

## 2. 对话页面错误修复

### 2.1 对话停止接口404
**问题**：`/api/conversations/{id}/stop` 端点不存在
**修复方案**：
- 在user-api中添加对话停止接口
- 文件：`/data/webUI-java/user-api/src/main/java/com/example/webui/userapi/controller/ConversationController.java`

### 2.2 流式输出问题
**问题**：ChatController的streamChat方法可能存在逻辑问题
**修复方案**：
- 检查streamChat方法中的SSE处理逻辑
- 确保Bisheng工作流和备用模型API都能正常返回流式输出

### 2.3 naive-ui logo请求失败
**问题**：请求`https://naive-ui.com/assets/naivelogo.93242402.svg`失败
**修复方案**：
- 移除或替换naive-ui logo引用
- 使用本地资源或其他可靠CDN

### 2.4 WebSocket持续输出
**问题**：WebSocket连接异常
**修复方案**：
- 检查前端WebSocket配置
- 确保连接正确关闭

## 3. 注册页面错误修复

**问题**：直接请求`.vue`文件，路由配置错误
**修复方案**：
- 检查Vite路由配置
- 确保注册页面路由正确配置
- 文件：`/data/webUI-java/user-web/src/router/index.ts`

## 4. /api/messages/{conversationId} 500错误修复

**问题**：MessageController的list方法可能存在分页或查询问题
**修复方案**：
- 检查list方法中的PageRequest逻辑
- 添加异常处理
- 测试不同参数组合下的查询

## 5. Bisheng工作流集成修复

### 5.1 工作流配置更新
**问题**：当前Bisheng工作流配置可能不正确
**修复方案**：
- 更新application.yml中的Bisheng配置
- 使用正确的URL、工作流ID和API密钥
- 文件：`/data/webUI-java/user-api/src/main/resources/application.yml`

### 5.2 工作流调用逻辑修复
**问题**：Bisheng工作流调用可能存在逻辑问题
**修复方案**：
- 更新ChatController中的Bisheng调用逻辑
- 使用正确的工作流ID `359c0fdb94574688ba53a5c4632f7e82`
- 实现工作流停止功能

### 5.3 工作流管理界面完善
**问题**：前端工作流管理界面需要完善
**修复方案**：
- 检查admin-web的工作流管理组件
- 确保能正确配置和测试工作流
- 文件：`/data/webUI-java/admin-web/src/views/Workflows.vue`

## 6. 数据库和配置检查

**问题**：确保所有配置正确录入数据库
**修复方案**：
- 检查模型配置和工作流配置的数据库记录
- 确保前端能正确读取和更新这些配置
- 测试增删改查功能

## 7. 全面测试计划

1. **功能测试**：
   - 管理员登录和权限管理
   - 用户注册和登录
   - 对话功能（含流式输出）
   - 模型配置管理
   - 工作流配置和调用

2. **性能测试**：
   - 大模型多轮对话
   - Bisheng工作流调用延迟
   - 数据库查询性能

3. **稳定性测试**：
   - 长时间运行测试
   - 并发请求测试
   - 错误恢复测试

## 8. 服务重启计划

修复完成后，按照以下顺序重启服务：
1. 数据库服务
2. admin-api（端口11025）
3. user-api（端口11031）
4. admin-web（端口13085）
5. user-web（端口13089）

## 9. 代码参考和资源

- Bisheng工作流代码参考：`/data/webUI-java/tvi-millions-engine-portal-web-test`
- Bisheng配置参考：`/data/webUI-java/完整bisheng.txt`
- 工作流名称：Qwen3-32B-大模型备案-api版

## 10. 预期交付结果

- 所有前端警告和错误消除
- 所有API端点正常响应
- Bisheng工作流成功集成并测试通过
- 系统稳定运行，无异常日志
- 完整的测试报告

## 11. 风险评估

- Bisheng工作流连接可能受网络环境影响
- 大模型API调用可能存在延迟
- 数据库迁移可能影响现有数据

## 12. 缓解措施

- 实现fallback机制，确保系统在外部服务不可用时仍能正常运行
- 添加详细的错误日志和监控
- 进行数据备份，确保数据安全

这个修复计划涵盖了所有报告的问题，将系统恢复到正常运行状态，并确保所有功能都能正常工作。