# 系统功能修复计划

## 问题分析

1. **管理端登录问题**：
   - **当前状态**：已修复，5次测试均成功
   - **问题**：无

2. **bisheng工作流调用问题**：
   - **问题**：页面对话输入内容测试返回"工作流未返回有效内容"
   - **原因**：ChatController中的streamChat方法未正确处理bisheng工作流返回的SSE事件
   - **解决方案**：修复streamChat方法，正确处理output_msg事件，提取message字段作为AI回复内容

3. **大模型API调用问题**：
   - **问题**：调用大模型API出现报错，没有模型输出内容
   - **原因**：API调用代码可能存在问题，需要检查和修复
   - **解决方案**：修复大模型API调用代码，确保能正确发送请求和处理响应

## 修复步骤

### 1. 修复bisheng工作流调用问题

* **修改文件**：`/data/webUI-java/user-api/src/main/java/com/example/webui/userapi/controller/ChatController.java`
* **修复内容**：
  - 完善streamChat方法中的bisheng工作流调用逻辑
  - 正确处理SSE事件，特别是output_msg事件
  - 提取output_schema中的message字段作为AI回复内容
  - 支持guide_word、guide_question等事件类型

### 2. 修复大模型API调用问题

* **修改文件**：`/data/webUI-java/user-api/src/main/java/com/example/webui/userapi/controller/ChatController.java`
* **修复内容**：
  - 完善chat方法中的大模型API调用逻辑
  - 确保能正确发送请求和处理响应
  - 添加错误处理机制

### 3. 测试修复效果

* **管理端登录测试**：5次连续测试
* **bisheng工作流测试**：5次连续测试
* **大模型API测试**：5次连续测试

## 预期结果

1. 管理端登录功能稳定，5次测试均成功
2. bisheng工作流能正确调用，返回有效内容
3. 大模型API能正确调用，返回模型输出内容
4. 系统稳定运行，没有报错

## 修复验证

* 每个问题不少于5次不同的验证
* 所有问题验证通过后才算完成