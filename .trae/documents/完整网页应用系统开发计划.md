# 完整网页应用系统开发计划

## 1. 技术栈选择

### 前端
- **框架**: React 18 + TypeScript
- **构建工具**: Vite
- **样式框架**: Tailwind CSS (响应式设计)
- **路由管理**: React Router v6
- **HTTP客户端**: Axios
- **状态管理**: React Context API (轻量级状态管理)

### 后端
- **运行时**: Node.js 18
- **框架**: Express.js + TypeScript
- **身份验证**: JWT (JSON Web Tokens)
- **密码加密**: bcrypt
- **ORM**: Prisma

### 数据库
- **数据库**: PostgreSQL 15
- **数据迁移**: Prisma Migrate
- **敏感数据加密**: 字段级加密

### 部署
- **容器化**: Docker
- **编排工具**: Docker Compose
- **前端服务器**: Nginx

## 2. 项目结构设计

```
webUI/
├── frontend/           # 前端应用
│   ├── src/
│   │   ├── components/ # 通用组件
│   │   ├── pages/      # 页面组件
│   │   ├── services/   # API服务
│   │   ├── types/      # TypeScript类型定义
│   │   ├── hooks/      # 自定义Hooks
│   │   └── App.tsx     # 主应用组件
│   ├── package.json
│   ├── vite.config.ts
│   └── Dockerfile
├── backend/            # 后端应用
│   ├── src/
│   │   ├── controllers/ # 控制器
│   │   ├── models/      # 数据模型
│   │   ├── routes/      # 路由
│   │   ├── services/    # 业务逻辑
│   │   ├── middleware/  # 中间件
│   │   └── app.ts       # 主应用
│   ├── package.json
│   ├── tsconfig.json
│   ├── prisma/         # Prisma配置和迁移
│   └── Dockerfile
├── docker-compose.yml
└── README.md
```

## 3. 实现步骤

### 阶段1: 项目初始化
1. 创建项目根目录
2. 初始化前端React + TypeScript + Vite项目
3. 初始化后端Express + TypeScript项目
4. 配置Prisma ORM
5. 创建基础Docker配置文件

### 阶段2: 数据库设计与实现
1. 设计数据模型
   - 用户表 (users)
   - 对话表 (conversations)
   - 消息表 (messages)
   - 投诉建议表 (feedback)
2. 生成Prisma迁移文件
3. 配置数据库连接
4. 实现敏感数据加密方案

### 阶段3: 后端API开发
1. 实现用户认证模块
   - 注册API
   - 登录API
   - JWT中间件
2. 实现用户信息管理API
3. 实现对话历史API
4. 实现投诉建议提交API
5. 实现大模型接口集成层
6. 添加安全防护中间件

### 阶段4: 前端页面开发
1. 开发通用组件
   - 导航栏
   - 页脚
   - 按钮
   - 输入框
   - 弹窗组件
2. 开发登录页面
   - 用户名/密码输入
   - 隐私协议弹窗
   - 模型服务协议弹窗
   - 协议阅读检测
   - 登录流程控制
3. 开发注册页面
   - 基础信息表单
   - 实名认证表单
   - 表单验证
4. 开发大模型对话页面
   - 消息输入框
   - 对话历史展示
   - 消息状态管理
   - 对话控制功能
5. 开发投诉举报与建议页面
   - 分类选择
   - 内容输入
   - 提交功能

### 阶段5: 系统集成与测试
1. 前端与后端API集成
2. 测试完整用户流程
3. 测试对话功能
4. 测试投诉建议功能
5. 性能测试
6. 安全测试

### 阶段6: Docker部署配置
1. 优化前端Dockerfile
2. 优化后端Dockerfile
3. 编写docker-compose.yml
4. 配置容器间网络
5. 配置数据持久化
6. 测试Docker部署流程

## 4. 关键功能实现细节

### 协议阅读检测
- 使用Intersection Observer API检测滚动到底部
- 实现阅读进度跟踪
- 只有两个协议都阅读完成后，勾选框才可用

### 大模型对话
- 使用WebSocket或SSE实现实时消息推送
- 实现消息队列管理
- 支持对话历史分页加载
- 实现消息导出为JSON或PDF功能

### 数据安全
- 密码使用bcrypt加盐哈希存储
- 敏感信息（身份证、手机号）使用字段级加密
- API请求使用JWT认证
- 实现请求频率限制

## 5. 部署方案

### Docker Compose配置
- 三个服务：前端、后端、PostgreSQL
- 前端使用Nginx反向代理
- 后端连接PostgreSQL数据库
- 配置环境变量管理
- 数据卷持久化存储

### 部署步骤
1. 克隆代码仓库
2. 配置环境变量
3. 运行`docker-compose up -d`
4. 访问应用

## 6. 开发时间预估

| 阶段 | 时间 |
|------|------|
| 项目初始化 | 1天 |
| 数据库设计与实现 | 1天 |
| 后端API开发 | 2天 |
| 前端页面开发 | 3天 |
| 系统集成与测试 | 1天 |
| Docker部署配置 | 1天 |
| 总计 | 9天 |

## 7. 交付物

1. 完整的源代码
2. Docker镜像
3. docker-compose.yml配置文件
4. 部署文档
5. API文档

这个计划涵盖了从项目初始化到最终部署的所有步骤，确保系统的完整性、安全性和可扩展性。