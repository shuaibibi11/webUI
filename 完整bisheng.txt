接口基本信息
1. 工作流请求执行接口
POST
http://192.168.3.52:3001/api/v2/workflow/invoke
2. 工作流停止运行接口
POST
http://192.168.3.52:3001/api/v2/workflow/stop

如时序图所示，在对接工作流 API 时，一般会经历以下步骤：

1. 第一步：发起工作流执行。通过/invoke 接口让工作流从开始节点开始运行：



import requests
import json

url = "http://192.168.3.52:3001/api/v2/workflow/invoke"

payload = json.dumps({
   "workflow_id": "359c0fdb94574688ba53a5c4632f7e82",
   "stream": False, # 为空或者不传，都会请求流式返回工作流事件。本示例为了直观展示返回结果，所以改
为非流式请求，真实场景下为了用户体验建议请求流式。
})

headers = {
   'Content-Type': 'application/json'
}

response = requests.request("POST", url, headers=headers, data=payload)

print(response.text)# 输出工作流的响应

2. 第二步：获取并解析工作流返回的事件。（一定要保留 session_id 等上下文信息，以便后续继续请求）
{
    "status_code": 200,
    "status_message": "SUCCESS",
    "data": {
        "session_id": "d4347ab8e8cd48c48ac9920dbb5a9b35_async_task_id",
        "events": [
            {
                "event": "guide_word",
                "message_id": null,
                "status": "end",
                "node_id": "start_553b9",
                "node_execution_id": "ce9a73b376c647159b1b2de1806129cf",
                "output_schema": {
                    "message": "您好，请问想聊些什么呢？",
                    "reasoning_content": null,
                    "output_key": null,
                    "files": null,
                    "source_url": null,
                    "extra": null
                },
                "input_schema": null
            },
            {
                "event": "input",
                "message_id": "387216",
                "status": "end",
                "node_id": "input_2775b",
                "node_execution_id": null,
                "output_schema": null,
                "input_schema": {
                    "input_type": "dialog_input",
                    "value": [
                        {
                            "key": "user_input",
                            "type": "text",
                            "value": null,
                            "label": null,
                            "multiple": false,
                            "required": true,
                            "options": null
                        }
                    ]
                }
            }
        ]
    }
}

3. 第三步：根据事件类型渲染前端，并收集用户输入。

如果事件是 普通输出（比如 event="output_msg"），则直接展示内容。
如果事件是 等待用户交互输入（比如 event="input" 或 event="output_with_input_msg" 或 event="output_with_choose_msg"），则需要渲染对应的界面（对话框、表单等）。

4. 第四步：带着用户输入再次调用 /invoke 接口。

payload = json.dumps({
    "workflow_id": "7481368b-dd1c-43ef-a254-dce219ee53e8",
    "stream": False,  # 启用流式传输
    "input": {"input_2775b": {  # 事件里的节点ID
        "user_input": "贵州茅台股价情况"  # 使用从文件中读取的文本
    }},
    "message_id": "387216",
    "session_id": "1fc60fe0edb44219bbef5f8870dd4639_async_task_id"
})
5. 第五步：继续获取并解析返回的事件……直到返回 close 事件（非必须）结束工作流运行，也可调用 POST /workflow/stop 接口手动终止工作流。

返回事件类型与处理方式
工作流返回的响应 JSON 通常包含一个或多个事件对象（数组形式），每个事件的字段可能不一样，以下枚举全部字段情况（非真实值，仅供参考）：

数据结构	示例

event
str
事件名称
必需
node_id
str
触发事件的节点ID
必需
message_id
str
消息在数据库中的唯一ID
必需
node_execution_id
str
执行此节点时的唯一ID
必需
input_schema
Json
需要用户输入的schema
必需
input_type
str
输入类型
可选
示例值：form_input
输入方式
value
JsonArray
需要用户输入的字段信息
可选
key
str
字段的唯一key
可选
示例值：category
type
str
字段类型
可选
示例值：select
value
str
字段的默认值
可选
multiple
boolean
是否支持多选
可选
示例值：True
label
str
字段的展示名称
可选
示例值：请选择接下来要进行的操作
options
JsonArray
下拉框类型的选项列表
可选
id
str
选项的唯一ID
可选
示例值：0b8a2fe9
text
str
选项的文本
可选
示例值：操作1
type
str
选项类型
可选
required
boolean
是否必填
可选
示例值：True
output_schema
Json
输出schema
必需
message
str
输出的内容
可选
reasoning_content
str
推理模型的思考过程内容
可选
output_key
str
输出内容对应的变量key
可选
示例值：output
files
JsonArray
文件列表
可选
path
str
文件路径
可选
示例值：http://minio:9000/xxx.png?aa=xxx
name
str
文件名称
可选
示例值：测试图片.png
source_url
str
溯源url
可选
extra
str
QA知识库溯源内容
可选
示例值：{"qa": "本答案来源于已有问答库: QA 知识库", "url": null}

{
  "event": "guide_word",  
  # 表示当前事件类型，例如 guide_word（开场白事件）、guide_question（引导问题事件）、input（等待输入事件）、output_msg（输出事件）、close（结束事件）……
  
  "node_id": "input_xxxx",  
  # 当前事件是由哪个工作流节点触发的。对于需要输入的事件（如 event="input"），必须在后续请求中携带此 node_id ，以告诉后端对哪个节点进行输入。 
  
  "message_id": "xxxxxxx",  
  # 消息在数据库中的唯一ID
  
  "node_execution_id": "xxxxx",  
  # 此节点时的唯一执行ID。由于同一个节点可能在运行过程中执行多次，该字段用于唯一标识某次节点执行，在流式输出事件中，需要用它来区分多条流式消息。
  
  "input_schema": {   # input_schema ：需要用户输入的schema，此字段不为空 则需要给用户渲染对应的输入UI
    "input_type": "form_input",  
    # input_type：输入类型。取值范围包括：1) form_input：表单形式的输入；2) dialogue_input：对话框形式的用户输入；3)message_inline_input：需要用户输入的消息;4)需要用户选择的消息。
    
    "value": [  # 需要用户输入哪些字段信息，随着 input_type 类型不同，需要填写不同的字段
      {
        "key": "category",  # 字段的唯一key，拼接用户输入时，使用此key
        "type": "select",  # 字段类型，1）text：文本输入框；2）file：文件上传；3）select：下拉框
        "value": "",  # 字段的默认值
        "multiple": True,  # type=select时，通过此字段指定下拉框是否可多选
        "label": "请选择接下来要进行的操作",  # 字段的前端展示名称
        "options": [  # 如果 type=select，则在这里列出可选值的 id、text 等信息
          {
            "id": "0b8a2fe9",
            "text": "操作1",
            "type": ""
          },
          {
            "id": "eb5f4ade",
            "text": "操作2",
            "type": ""
          }
        ],  
        "required": True  # 是否必填
      }
    ]
  },
  "output_schema": {# 需要在用户会话界面展示的数据
    "message": "输出内容",  # 直接展示给用户的文本输出内容。
    "reasoning_content"："思考过程内容" # R1 等推理模型的思考过程内容
    "output_key": "output",  # 输出内容对应的变量标识
    "files": [  # 文件文件列表，每个文件包含 path 和 name 信息。前端可据此展示文件列表，允许用户下载或者预览。
      {
        "path": "http://minio:9000/xxx.png?aa=xxx",
        "name": "测试图片.png"
      }
    ],
    "source_url": "",  # 知识库问答溯源页面地址，需要自己拼接毕昇的前端地址。具体是否支持溯源请参考产品文档
    "extra": "{"qa": "本答案来源于已有问答库: QA 知识库", "url": null}"  # QA知识库溯源内容
  },
}


开场白事件
样式预览	示例
{
  "event": "guide_word",  # 开场白事件
  "node_id": "start_xxx",  # 节点ID，
  "node_execution_id": "xxxxxxxx",  # 执行此节点的唯一标识
  "output_schema": {  # output
    "message": "本工作流可以解决xxxx等问题"
  }
}
处理逻辑：将 output_schema.message 展示给用户即可。

引导问题事件
事件数据示例

样式预览	示例

{
  "event": "guide_question",
  "node_id": "start_xxx",
  "node_execution_id": "xxxxxxxx",
  "output_schema": {
    "message": [
      "引导问题1",
      "引导问题2"
    ]
  }
}
处理逻辑：向用户展示引导问题列表，将用户选中的问题作为输入，继续调用工作流接口。

等待输入事件-对话框形式
当工作流返回 event="input" 且 input_type="dialog_input"时，表示后端希望前端在对话框中接收用户输入以及上传文件（非必须）。

下一次请求 /invoke 接口必带的关键字段是 node_id,message_id,session_id 以及对话框输入。

事件数据示例

样式预览	示例
{
    "event": "input",# 等待输入事件
    "node_id": "input_xxxx",
    "node_execution_id": "xxxxx",
    "input_schema": {
        "input_type": "dialog_input",# 对话框形式
        "value": [
            {
                "key": "user_input",
                "type": "text"
            },
            {
                "key": "dialog_files_content", # 需要用户上传文件
                "type": "dialog_file"
            },
            {
                "key": "dialog_file_accept",  # 上传文件的格式限制
                "type": "dialog_file_accept",
                "value": "all"  # 允许的文件类型
            }
        ]
    }
}
处理逻辑：

绘制对话框，接收用户输入内容
携带 node_id、session_id、message_id 再次请求 /workflow/invoke
如果用户没有在对话框内上传文件，请求示例如下
payload = json.dumps({
    "workflow_id": "c90bb7f2-b7d1-49bf-9fb6-3ab60ff8e414",
    "session_id": "d4347ab8e8cd48c48ac9920dbb5a9b35_async_task_id",  # 上次返回的 session_id
    "message_id": "385140",
    "input": {
        "input_2775b": {  # 这里对应返回事件里的 node_id
            # input_schema.value中元素的 key 以及对应要传入的值
            "user_input": "你好"
        }
    }
})
如果用户在对话框内上传了文件
如果有文件类型，调用毕昇文件上传接口获取到文件url，示例如下：
import requests
def upload_file(local_path: str):
    server = "http://ip:port"
    url = server + '/api/v1/knowledge/upload'
    headers = {}
    files = {'file': open(local_path, 'rb')}
    res = requests.post(url, headers=headers, files=files)
    file_path = res.json()['data'].get('file_path', '')
    return file_path
    
 financeA = upload_file("caibao.pdf")
 financeB = upload_file("caibao2.pdf")
成功获取用户的输入和上传文件的url后，拼接为如下格式的接口入参
payload = json.dumps({
    "workflow_id": "c90bb7f2-b7d1-49bf-9fb6-3ab60ff8e414",
    "session_id": "d4347ab8e8cd48c48ac9920dbb5a9b35_async_task_id",  # 上次返回的 session_id
    "message_id": "385140",
    "input": {
        "input_2775b": {  # 这里对应返回事件里的 node_id
            # input_schema.value中元素的 key 以及对应要传入的值
            "user_input": "你好",
            # 上传文件后获取到的文件url列表
            "dialog_files_content": ["minio://127.0.0.1:9000/xxxx"]
        }
    }
})
等待输入事件-表单形式
当工作流返回 event="input" 且 input_type="form_input"时，后端希望前端渲染一个表单，让用户填写内容。

下一次请求 /invoke 接口必带的字段是 node_id, message_id, session_id 以及用户填写的表单值。

事件数据示例

样式预览	示例
{
    "event": "input",
    "node_id": "input_xxxx",
    "node_execution_id": "xxxxx",
    "input_schema": {
        "input_type": "form_input",
        "value": [
            {
                "key": "text_input",
                "type": "text",
                "value": "文本输入类型",
                "label": "文本输入类型",
                "options": [],
                "required": true
            },
            {
                "key": "file",
                "type": "file",
                "value": "",
                "label": "文件类型的输入",
                "options": [],
                "required": true
            },
            {
                "key": "category",
                "type": "select",
                "value": "",
                "label": "下拉框类型",
                "required": true,
                "multiple": false,
                "options": [
                    {
                        "id": "0b8a2fe9",
                        "text": "选项1",
                        "type": ""
                    },
                    {
                        "id": "eb5f4ade",
                        "text": "选项2",
                        "type": ""
                    }
                ]
            }
        ]
    }
}
处理逻辑：

解析input_schema.value 中的表单元素，在前端渲染表单样式
如果有文件类型，调用毕昇文件上传接口获取到文件url，示例如下：
import requests
def upload_file(local_path: str):
    server = "http://ip:port"
    url = server + '/api/v1/knowledge/upload'
    headers = {}
    files = {'file': open(local_path, 'rb')}
    res = requests.post(url, headers=headers, files=files)
    file_path = res.json()['data'].get('file_path', '')
    return file_path
    
 financeA = upload_file("caibao.pdf")
 financeB = upload_file("caibao2.pdf")
3. 提交时，JSON 中要和返回的 key 对应，并带上 session_id、message_id、node_id 等必备信息。

{
    "workflow_id": "xxxxx",
    "session_id": "使用接口返回的session_id",
    "message_id": "xxxxx",
    "input": {
        "input_xxx": {  # 事件里的 node_id
            # key是input_schema.value中元素的 key 以及对应要传入的值
            "text_input": "用户输入的内容",
            "file": ["minio://127.0.0.1:9000/xxxx"] # 用户上传文件获取到的文件url, 允许多选就是多个url
            "category": "选项2" # 将选项内容赋值给变量。当允许多选时，多个选项内容通过逗号分隔。
        }
    }
}
输出事件
事件数据示例

样式预览	示例
{
  "event": "output_msg",
  "node_id": "output_xxx",
  "node_execution_id": "xxxxxxxxx",
  "output_schema": {
    "message": "输出内容",
    "output_key": "output",
    "files": [
      {
        "path": "http://minio:9000/xxx.png?aa=xxx",
        "name": "测试图片.png"
      }
    ],
    "source_url": ""
  }
}
处理逻辑：

将 output_schema.message 展示给用户
如果 files 不为空，则提供文件下载按钮或预览功能
source_url 基于毕昇服务根路径，需要拼接毕昇访问地址才可访问
输出事件-需输入类型
此时工作流处于待输入状态

事件数据示例

样式预览	示例
{
    "event": "output_with_input_msg",
    "node_id": "output_ 123",
    "node_execution_id": "xxxxxxxxx",
    "message_id": "xxxxx",
    "output_schema": {
        "message": "输出内容",
        "output_key": "output",
        "files": [
            {
                "path": "http://minio:9000/xxx.png?aa=xxx",
                "name": "测试图片.png"
            }
        ],
        "source_url": ""
    },
    "input_schema": {
        "input_type": "message_inline_input",
        "value": [
            {
                "key": "output_result",
                "type": "text",
                "value": "以下是AI生成的的草稿：XXXX"
            }
        ]
    }
}
处理逻辑：

展示 output_schema 内容
根据 input_schema 在消息体中绘制输入框，input_schema.value.value 为输入框内的默认值，用户可在其基础上二次编辑
用户编辑或确认后，再次调用 API 提交。示例如下：
{
    "workflow_id": "xxxxx",
    "session_id": "使用接口返回的session_id",
    "message_id": "消息的唯一ID",
    "input": {
        "output_123": {  # 事件里的节点ID
            # key是input_schema.value中元素的key
            "output_result": "用户输入的内容"
        }
    }
}
输出事件-选择类型
此时工作流处于待输入状态

事件数据示例

样式预览	示例
{
    "event": "output_with_choose_msg",
    "node_id": "output_xxx",
    "node_execution_id": "xxxxxxxxx",
    "message_id": "xxxxx",
    "output_schema": {
        "message": "输出内容",
        "output_key": "output",
        "files": [
            {
                "path": "http://minio:9000/xxx.png?aa=xxx",
                "name": "测试图片.png"
            }
        ],
        "source_url": ""
    },
    "input_schema": {
        "input_type": "message_inline_option",
        "value": [
            {
                "key": "output_result",
                "type": "select",
                "value": "",
                "options": [
                    {
                        "id": "e2107f75",
                        "label": "选项1",
                        "value": ""
                    },
                    {
                        "id": "790c36f9",
                        "label": "选项2",
                        "value": ""
                    }
                ]
            }
        ]
    }
}
处理逻辑：

展示 output_schema 内容
根据 input_schema 在消息体中绘制选项
接收到用户选择动作后，拼接接口的入参，再次调用 API，示例如下：
{
    "workflow_id": "xxxxx",
    "session_id": "使用接口返回的session_id",
    "message_id": "xxxxxx",
    "input": {
        "output_xxx": {  # 事件里的节点ID
            # key是input_schema.value中元素的key
            "output_result": "e2107f75"  # 用户选择选项对应的id
        }
    }
}
流式输出事件-输出中
事件数据示例

{
  "event": "stream_msg",
  "node_id": "llm_xxx",
  "node_execution_id": "xxxxxx",
  "status": "stream",
  "output_schema": {
    "message": "你",
    "reasoning_content": "",  # 深度思考的内容，message内容不为空代表深度思考结束
    "output_key": "output_1" # output_1 是节点中的输出变量名
  }
}
调用方处理示例

status="stream" 代表当处于流式输出中，需要根据 node_execution_id 和 output_schema.output_key 来确定流式内容是否属于同一条消息（节点批量运行模式下，会共用同一个 node_execution_id，所以需要根据 output_key 来区分是否是不同的消息）。
如果找到对应的消息，则将 message 内容添加到对应的消息里。
如果未找到对应的消息，则开启一条新的消息，并将 message 和后续此消息的 message 拼接在一起。
流式输出事件-结束
事件数据示例

{
  "event": "stream_msg",
  "node_id": "llm_xxx",
  "node_execution_id": "xxxxxx",
  "status": "end",  # end表示流式事件结束了
  "output_schema": {
    "message": "你好，这是流式完成后最终的答案",
    "reasoning_content": "",  # 深度思考的内容，message内容不为空代表深度思考结束
    "output_key": "output_1",
    "source_url": "" # 是否支持溯源请参考产品文档
  }
}
处理逻辑

1. status="end"代表流式输出完成，此时根据 node_execution_id 和 output_schema.output_key 找到对应的message
2. 使用 message 内容覆盖之前流式输出的结果，显示最终完整答案
结束事件
当接收到 event="close" 时，代表工作流已运行结束

事件数据示例

{
  "event": "close",
  "unique_id": "xxxxxx",
  "status": "end",
  "output_schema": {
    "message": {
        "code": "500",
        "message": "报错内容"
    }# 如果为空表示工作流正常结束；如果不为空则表示执行出错，内容就是错误信息
  }
}
处理逻辑

判断message是否为空，为空则告知用户工作流运行结束
如果message不为空，则告知用户工作流运行失败，并把报错信息抛出给用户或者自行处理
示例
500: 服务端异常，查看后端日志解决
10527: 工作流等待用户输入超时
10528: 节点执行超过最大次数
10531: <节点名称>功能已升级，需删除后重新拖入。
10532: 工作流版本已升级，请联系创建者重新编排
10540: 服务器线程数已满，请稍候再试